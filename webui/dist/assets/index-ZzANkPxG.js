var ll=Object.defineProperty;var sl=(e,t,l)=>t in e?ll(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l;var _t=(e,t,l)=>sl(e,typeof t!="symbol"?t+"":t,l);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function l(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=l(a);fetch(a.href,r)}})();function te(){}function zt(e){return e()}function kt(){return Object.create(null)}function Re(e){e.forEach(zt)}function gt(e){return typeof e=="function"}function ze(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function nl(e){return Object.keys(e).length===0}function Wt(e,...t){if(e==null){for(const s of t)s(void 0);return te}const l=e.subscribe(...t);return l.unsubscribe?()=>l.unsubscribe():l}function pt(e,t,l){e.$$.on_destroy.push(Wt(t,l))}function n(e,t){e.appendChild(t)}function U(e,t,l){e.insertBefore(t,l||null)}function j(e){e.parentNode&&e.parentNode.removeChild(e)}function ot(e,t){for(let l=0;l<e.length;l+=1)e[l]&&e[l].d(t)}function d(e){return document.createElement(e)}function E(e){return document.createTextNode(e)}function g(){return E(" ")}function vt(){return E("")}function H(e,t,l,s){return e.addEventListener(t,l,s),()=>e.removeEventListener(t,l,s)}function i(e,t,l){l==null?e.removeAttribute(t):e.getAttribute(t)!==l&&e.setAttribute(t,l)}function rl(e){return Array.from(e.childNodes)}function le(e,t){t=""+t,e.data!==t&&(e.data=t)}function Jt(e,t){e.value=t??""}function ct(e,t,l){for(let s=0;s<e.options.length;s+=1){const a=e.options[s];if(a.__value===t){a.selected=!0;return}}e.selectedIndex=-1}function al(e,t,{bubbles:l=!1,cancelable:s=!1}={}){return new CustomEvent(e,{detail:t,bubbles:l,cancelable:s})}let it;function at(e){it=e}function Qt(){if(!it)throw new Error("Function called outside component initialization");return it}function ol(e){Qt().$$.on_mount.push(e)}function nt(){const e=Qt();return(t,l,{cancelable:s=!1}={})=>{const a=e.$$.callbacks[t];if(a){const r=al(t,l,{cancelable:s});return a.slice().forEach(o=>{o.call(e,r)}),!r.defaultPrevented}return!0}}const lt=[],wt=[];let st=[];const xt=[],il=Promise.resolve();let mt=!1;function ul(){mt||(mt=!0,il.then(Gt))}function ht(e){st.push(e)}const bt=new Set;let et=0;function Gt(){if(et!==0)return;const e=it;do{try{for(;et<lt.length;){const t=lt[et];et++,at(t),dl(t.$$)}}catch(t){throw lt.length=0,et=0,t}for(at(null),lt.length=0,et=0;wt.length;)wt.pop()();for(let t=0;t<st.length;t+=1){const l=st[t];bt.has(l)||(bt.add(l),l())}st.length=0}while(lt.length);for(;xt.length;)xt.pop()();mt=!1,bt.clear(),at(e)}function dl(e){if(e.fragment!==null){e.update(),Re(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ht)}}function cl(e){const t=[],l=[];st.forEach(s=>e.indexOf(s)===-1?t.push(s):l.push(s)),l.forEach(s=>s()),st=t}const dt=new Set;let Ze;function fl(){Ze={r:0,c:[],p:Ze}}function _l(){Ze.r||Re(Ze.c),Ze=Ze.p}function Ue(e,t){e&&e.i&&(dt.delete(e),e.i(t))}function Fe(e,t,l,s){if(e&&e.o){if(dt.has(e))return;dt.add(e),Ze.c.push(()=>{dt.delete(e),s&&(l&&e.d(1),s())}),e.o(t)}else s&&s()}function Be(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ye(e){e&&e.c()}function Je(e,t,l){const{fragment:s,after_update:a}=e.$$;s&&s.m(t,l),ht(()=>{const r=e.$$.on_mount.map(zt).filter(gt);e.$$.on_destroy?e.$$.on_destroy.push(...r):Re(r),e.$$.on_mount=[]}),a.forEach(ht)}function Qe(e,t){const l=e.$$;l.fragment!==null&&(cl(l.after_update),Re(l.on_destroy),l.fragment&&l.fragment.d(t),l.on_destroy=l.fragment=null,l.ctx=[])}function pl(e,t){e.$$.dirty[0]===-1&&(lt.push(e),ul(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function qe(e,t,l,s,a,r,o=null,f=[-1]){const u=it;at(e);const c=e.$$={fragment:null,ctx:[],props:r,update:te,not_equal:a,bound:kt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:kt(),dirty:f,skip_bound:!1,root:t.target||u.$$.root};o&&o(c.root);let _=!1;if(c.ctx=l?l(e,t.props||{},(p,m,...x)=>{const h=x.length?x[0]:m;return c.ctx&&a(c.ctx[p],c.ctx[p]=h)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](h),_&&pl(e,p)),m}):[],c.update(),_=!0,Re(c.before_update),c.fragment=s?s(c.ctx):!1,t.target){if(t.hydrate){const p=rl(t.target);c.fragment&&c.fragment.l(p),p.forEach(j)}else c.fragment&&c.fragment.c();t.intro&&Ue(e.$$.fragment),Je(e,t.target,t.anchor),Gt()}at(u)}class Ke{constructor(){_t(this,"$$");_t(this,"$$set")}$destroy(){Qe(this,1),this.$destroy=te}$on(t,l){if(!gt(l))return te;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(l),()=>{const a=s.indexOf(l);a!==-1&&s.splice(a,1)}}$set(t){this.$$set&&!nl(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const bl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(bl);function St(e){let t,l,s,a=(e[4]||"Ready")+"",r,o,f,u=e[5]&&Ct(e);return{c(){t=d("div"),l=d("div"),s=d("p"),r=E(a),o=g(),u&&u.c(),i(l,"class","flex flex-wrap items-center justify-between gap-2"),i(t,"class",f=`mt-3 rounded-lg border px-3 py-2 text-sm ${e[6]}`)},m(c,_){U(c,t,_),n(t,l),n(l,s),n(s,r),n(l,o),u&&u.m(l,null)},p(c,_){_&16&&a!==(a=(c[4]||"Ready")+"")&&le(r,a),c[5]?u?u.p(c,_):(u=Ct(c),u.c(),u.m(l,null)):u&&(u.d(1),u=null),_&64&&f!==(f=`mt-3 rounded-lg border px-3 py-2 text-sm ${c[6]}`)&&i(t,"class",f)},d(c){c&&j(t),u&&u.d()}}}function Ct(e){let t,l,s;return{c(){t=d("p"),l=E("Last Sync: "),s=E(e[5]),i(t,"class","text-xs font-medium uppercase tracking-wide")},m(a,r){U(a,t,r),n(t,l),n(t,s)},p(a,r){r&32&&le(s,a[5])},d(a){a&&j(t)}}}function ml(e){let t,l,s,a,r,o,f=e[3]?"Reloading...":"Reload Server",u,c,_,p=e[2]?"Saving...":"Save to Server",m,x,h,S,v,b,I,w,L,M,D=(e[4]||e[5])&&St(e);return{c(){t=d("header"),l=d("div"),s=d("div"),s.innerHTML='<p class="text-[11px] font-semibold uppercase tracking-[0.22em] text-slate-400">PRX PROXY</p> <h1 class="text-2xl font-black tracking-tight text-slate-100 md:text-3xl">Web UI</h1>',a=g(),r=d("div"),o=d("button"),u=E(f),c=g(),_=d("button"),m=E(p),x=g(),h=d("button"),h.textContent="Export JSON",S=g(),v=d("label"),b=E(`Import JSON
        `),I=d("input"),w=g(),D&&D.c(),i(o,"class","rounded-lg border border-cyan-400/40 bg-cyan-500/10 px-4 py-2 text-sm font-semibold text-cyan-200 hover:bg-cyan-500/20 disabled:cursor-not-allowed disabled:opacity-60"),o.disabled=e[1],i(_,"class","rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-4 py-2 text-sm font-semibold text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-60"),_.disabled=e[0],i(h,"class","rounded-lg border border-slate-600 bg-slate-900 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-800"),i(I,"class","hidden"),i(I,"type","file"),i(I,"accept","application/json"),i(v,"class","cursor-pointer rounded-lg border border-slate-600 bg-slate-900 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-800"),i(r,"class","flex flex-wrap gap-2"),i(l,"class","flex flex-wrap items-center justify-between gap-3"),i(t,"class","sticky top-3 z-20 rounded-2xl border border-slate-700/80 bg-slate-900/70 p-4 backdrop-blur lg:p-5")},m(N,k){U(N,t,k),n(t,l),n(l,s),n(l,a),n(l,r),n(r,o),n(o,u),n(r,c),n(r,_),n(_,m),n(r,x),n(r,h),n(r,S),n(r,v),n(v,b),n(v,I),n(t,w),D&&D.m(t,null),L||(M=[H(o,"click",e[9]),H(_,"click",e[10]),H(h,"click",e[11]),H(I,"change",e[12])],L=!0)},p(N,[k]){k&8&&f!==(f=N[3]?"Reloading...":"Reload Server")&&le(u,f),k&2&&(o.disabled=N[1]),k&4&&p!==(p=N[2]?"Saving...":"Save to Server")&&le(m,p),k&1&&(_.disabled=N[0]),N[4]||N[5]?D?D.p(N,k):(D=St(N),D.c(),D.m(t,null)):D&&(D.d(1),D=null)},i:te,o:te,d(N){N&&j(t),D&&D.d(),L=!1,Re(M)}}}function hl(e,t,l){let s,{saveDisabled:a=!1}=t,{reloadDisabled:r=!1}=t,{saving:o=!1}=t,{loading:f=!1}=t,{statusMessage:u=""}=t,{statusTone:c="neutral"}=t,{lastSynced:_=""}=t;const p=nt(),m=()=>p("reloadFromServer"),x=()=>p("saveToServer"),h=()=>p("exportJson"),S=v=>p("importJson",v);return e.$$set=v=>{"saveDisabled"in v&&l(0,a=v.saveDisabled),"reloadDisabled"in v&&l(1,r=v.reloadDisabled),"saving"in v&&l(2,o=v.saving),"loading"in v&&l(3,f=v.loading),"statusMessage"in v&&l(4,u=v.statusMessage),"statusTone"in v&&l(8,c=v.statusTone),"lastSynced"in v&&l(5,_=v.lastSynced)},e.$$.update=()=>{e.$$.dirty&256&&l(6,s=c==="ok"?"border-emerald-400/40 bg-emerald-500/10 text-emerald-200":c==="error"?"border-rose-400/40 bg-rose-500/10 text-rose-200":"border-slate-700 bg-slate-900/60 text-slate-300")},[a,r,o,f,u,_,s,p,c,m,x,h,S]}class gl extends Ke{constructor(t){super(),qe(this,t,hl,ml,ze,{saveDisabled:0,reloadDisabled:1,saving:2,loading:3,statusMessage:4,statusTone:8,lastSynced:5})}}function Tt(e,t,l){const s=e.slice();return s[16]=t[l],s}function vl(e){let t,l,s;return{c(){t=d("button"),t.textContent="Edit",i(t,"class","rounded-md border border-cyan-400/40 bg-cyan-500/10 px-3 py-1 text-xs font-semibold text-cyan-200 hover:bg-cyan-500/20")},m(a,r){U(a,t,r),l||(s=H(t,"click",e[9]),l=!0)},p:te,d(a){a&&j(t),l=!1,s()}}}function yl(e){let t,l,s,a,r,o;return{c(){t=d("div"),l=d("button"),l.textContent="Cancel",s=g(),a=d("button"),a.textContent="Save",i(l,"class","rounded-md border border-slate-600 bg-slate-900 px-3 py-1 text-xs font-semibold text-slate-200 hover:bg-slate-800"),i(a,"class","rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20"),i(t,"class","flex gap-2")},m(f,u){U(f,t,u),n(t,l),n(t,s),n(t,a),r||(o=[H(l,"click",e[10]),H(a,"click",e[11])],r=!0)},p:te,d(f){f&&j(t),r=!1,Re(o)}}}function kl(e){let t,l=e[0].log_level+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].log_level+"")&&le(s,l)},d(a){a&&j(t)}}}function wl(e){let t,l,s,a=Be(e[8]),r=[];for(let o=0;o<a.length;o+=1)r[o]=It(Tt(e,a,o));return{c(){t=d("select");for(let o=0;o<r.length;o+=1)r[o].c();i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100")},m(o,f){U(o,t,f);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(t,null);ct(t,e[2]),l||(s=H(t,"change",e[12]),l=!0)},p(o,f){if(f&256){a=Be(o[8]);let u;for(u=0;u<a.length;u+=1){const c=Tt(o,a,u);r[u]?r[u].p(c,f):(r[u]=It(c),r[u].c(),r[u].m(t,null))}for(;u<r.length;u+=1)r[u].d(1);r.length=a.length}f&260&&ct(t,o[2])},d(o){o&&j(t),ot(r,o),l=!1,s()}}}function It(e){let t,l=e[16]+"",s;return{c(){t=d("option"),s=E(l),t.__value=e[16],Jt(t,t.__value)},m(a,r){U(a,t,r),n(t,s)},p:te,d(a){a&&j(t)}}}function xl(e){let t,l=(e[0].prometheus_listen||"-")+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=(a[0].prometheus_listen||"-")+"")&&le(s,l)},d(a){a&&j(t)}}}function Sl(e){let t,l,s;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),t.value=e[3]},m(a,r){U(a,t,r),l||(s=H(t,"input",e[13]),l=!0)},p(a,r){r&8&&t.value!==a[3]&&(t.value=a[3])},d(a){a&&j(t),l=!1,s()}}}function Cl(e){let t,l=e[0].access_log?"true":"false",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].access_log?"true":"false")&&le(s,l)},d(a){a&&j(t)}}}function Tl(e){let t,l,s,a,r;return{c(){t=d("label"),l=d("input"),s=E(`
                Enabled`),i(l,"type","checkbox"),l.checked=e[4],i(t,"class","flex items-center gap-2 text-sm text-slate-300")},m(o,f){U(o,t,f),n(t,l),n(t,s),a||(r=H(l,"change",e[14]),a=!0)},p(o,f){f&16&&(l.checked=o[4])},d(o){o&&j(t),a=!1,r()}}}function Il(e){let t,l,s,a,r,o,f,u,c,_,p,m,x,h,S,v,b,I,w,L,M,D,N,k;function P(W,se){return W[1]?yl:vl}let T=P(e),O=T(e);function G(W,se){return W[1]?wl:kl}let ce=G(e),q=ce(e);function ie(W,se){return W[1]?Sl:xl}let oe=ie(e),Z=oe(e);function ue(W,se){return W[1]?Tl:Cl}let re=ue(e),$=re(e);return{c(){t=d("article"),l=d("div"),s=d("h2"),s.textContent="Observability",a=g(),O.c(),r=g(),o=d("div"),f=d("table"),u=d("thead"),u.innerHTML='<tr><th class="w-40 px-4 py-3 text-left font-semibold">Key</th> <th class="px-4 py-3 text-left font-semibold">Value</th></tr>',c=g(),_=d("tbody"),p=d("tr"),m=d("td"),m.textContent="log_level",x=g(),h=d("td"),q.c(),S=g(),v=d("tr"),b=d("td"),b.textContent="prometheus_listen",I=g(),w=d("td"),Z.c(),L=g(),M=d("tr"),D=d("td"),D.textContent="access_log",N=g(),k=d("td"),$.c(),i(s,"class","text-base font-bold text-slate-100"),i(l,"class","mb-3 flex items-center justify-between gap-2"),i(u,"class","bg-slate-900 text-slate-300"),i(m,"class","px-4 py-3 font-medium text-slate-200"),i(h,"class","px-4 py-3"),i(b,"class","px-4 py-3 font-medium text-slate-200"),i(w,"class","px-4 py-3"),i(D,"class","px-4 py-3 font-medium text-slate-200"),i(k,"class","px-4 py-3"),i(_,"class","divide-y divide-slate-800"),i(f,"class","min-w-full divide-y divide-slate-800 text-sm"),i(o,"class","overflow-hidden rounded-xl border border-slate-700 bg-slate-950/70"),i(t,"class","rounded-2xl border border-slate-700/80 bg-slate-900/80 p-4 backdrop-blur")},m(W,se){U(W,t,se),n(t,l),n(l,s),n(l,a),O.m(l,null),n(t,r),n(t,o),n(o,f),n(f,u),n(f,c),n(f,_),n(_,p),n(p,m),n(p,x),n(p,h),q.m(h,null),n(_,S),n(_,v),n(v,b),n(v,I),n(v,w),Z.m(w,null),n(_,L),n(_,M),n(M,D),n(M,N),n(M,k),$.m(k,null)},p(W,[se]){T===(T=P(W))&&O?O.p(W,se):(O.d(1),O=T(W),O&&(O.c(),O.m(l,null))),ce===(ce=G(W))&&q?q.p(W,se):(q.d(1),q=ce(W),q&&(q.c(),q.m(h,null))),oe===(oe=ie(W))&&Z?Z.p(W,se):(Z.d(1),Z=oe(W),Z&&(Z.c(),Z.m(w,null))),re===(re=ue(W))&&$?$.p(W,se):($.d(1),$=re(W),$&&($.c(),$.m(k,null)))},i:te,o:te,d(W){W&&j(t),O.d(),q.d(),Z.d(),$.d()}}}function Rl(e,t,l){let{observability:s}=t;const a=nt(),r=w=>w.currentTarget.value,o=w=>w.currentTarget.checked,f=w=>w.currentTarget.value,u=["trace","debug","info","warn","error"];let c=!1,_="",p="",m=!1;const x=()=>{l(1,c=!0)},h=()=>{l(1,c=!1)},S=()=>{a("change",{key:"log_level",value:_}),a("change",{key:"prometheus_listen",value:p}),a("change",{key:"access_log",value:m}),l(1,c=!1)},v=w=>l(2,_=f(w)),b=w=>l(3,p=r(w)),I=w=>l(4,m=o(w));return e.$$set=w=>{"observability"in w&&l(0,s=w.observability)},e.$$.update=()=>{e.$$.dirty&3&&(c||(l(2,_=s.log_level),l(3,p=s.prometheus_listen),l(4,m=s.access_log)))},[s,c,_,p,m,r,o,f,u,x,h,S,v,b,I]}class El extends Ke{constructor(t){super(),qe(this,t,Rl,Il,ze,{observability:0})}}const tt=[];function Al(e,t){return{subscribe:qt(e,t).subscribe}}function qt(e,t=te){let l;const s=new Set;function a(f){if(ze(e,f)&&(e=f,l)){const u=!tt.length;for(const c of s)c[1](),tt.push(c,e);if(u){for(let c=0;c<tt.length;c+=2)tt[c][0](tt[c+1]);tt.length=0}}}function r(f){a(f(e))}function o(f,u=te){const c=[f,u];return s.add(c),s.size===1&&(l=t(a,r)||te),f(e),()=>{s.delete(c),s.size===0&&l&&(l(),l=null)}}return{set:a,update:r,subscribe:o}}function Kt(e,t,l){const s=!Array.isArray(e),a=s?[e]:e;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const r=t.length<2;return Al(l,(o,f)=>{let u=!1;const c=[];let _=0,p=te;const m=()=>{if(_)return;p();const h=t(s?c[0]:c,o,f);r?o(h):p=gt(h)?h:te},x=a.map((h,S)=>Wt(h,v=>{c[S]=v,_&=~(1<<S),u&&m()},()=>{_|=1<<S}));return u=!0,m(),function(){Re(x),p(),u=!1}})}const ut=()=>({addr:"127.0.0.1:9000",tls:!1,sni:"localhost",weight:1,verify_cert:null,verify_hostname:null,connect_timeout_ms:null,total_connect_timeout_ms:null,read_timeout_ms:null,write_timeout_ms:null,idle_timeout_ms:null}),Xt=()=>({enabled:!1,consecutive_failures:3,open_ms:3e4}),ft=e=>({name:`route-${e}`,host:"",path_prefix:"/",is_default:e===1,lb:"round_robin",max_retries:0,retry_backoff_ms:0,circuit_breaker:Xt(),upstreams:[ut()]}),Yt=()=>({server:{listen:["0.0.0.0:8080"],health_path:"/healthz",ready_path:"/readyz",threads:null,grace_period_seconds:null,graceful_shutdown_timeout_seconds:null,config_reload_debounce_ms:250,tls:null},observability:{log_level:"info",access_log:!0,prometheus_listen:""},routes:[ft(1)]}),Ae=e=>e.replaceAll("\\","\\\\").replaceAll('"','\\"'),$e=e=>e?"true":"false",Nl=e=>`[${e.map(t=>`"${Ae(t)}"`).join(", ")}]`,Ge=(e,t,l)=>{l!==null&&Number.isFinite(l)&&e.push(`${t} = ${Math.max(0,Math.floor(l))}`)},Ll=e=>{const t=["[[route.upstream]]"];return t.push(`addr = "${Ae(e.addr)}"`),t.push(`tls = ${$e(e.tls)}`),e.sni.trim()&&t.push(`sni = "${Ae(e.sni)}"`),t.push(`weight = ${Math.min(256,Math.max(1,e.weight))}`),e.verify_cert!==null&&t.push(`verify_cert = ${$e(e.verify_cert)}`),e.verify_hostname!==null&&t.push(`verify_hostname = ${$e(e.verify_hostname)}`),Ge(t,"connect_timeout_ms",e.connect_timeout_ms),Ge(t,"total_connect_timeout_ms",e.total_connect_timeout_ms),Ge(t,"read_timeout_ms",e.read_timeout_ms),Ge(t,"write_timeout_ms",e.write_timeout_ms),Ge(t,"idle_timeout_ms",e.idle_timeout_ms),t.join(`
`)},Dl=e=>{const t=["[[route]]"];t.push(`name = "${Ae(e.name)}"`),e.host.trim()&&t.push(`host = "${Ae(e.host)}"`),t.push(`path_prefix = "${Ae(e.path_prefix||"/")}"`),t.push(`is_default = ${$e(e.is_default)}`),t.push(`lb = "${e.lb}"`),t.push(`max_retries = ${Math.max(0,e.max_retries)}`),t.push(`retry_backoff_ms = ${Math.max(0,e.retry_backoff_ms)}`),t.push(""),t.push("[route.circuit_breaker]"),t.push(`enabled = ${$e(e.circuit_breaker.enabled)}`),t.push(`consecutive_failures = ${Math.max(1,e.circuit_breaker.consecutive_failures)}`),t.push(`open_ms = ${Math.max(1,e.circuit_breaker.open_ms)}`),t.push("");const l=e.upstreams.map(Ll).join(`

`);return`${t.join(`
`)}${l}`},Ml=e=>{const t=[];t.push("[server]"),t.push(`listen = ${Nl(e.server.listen.filter(Boolean))}`),t.push(`health_path = "${Ae(e.server.health_path||"/healthz")}"`),t.push(`ready_path = "${Ae(e.server.ready_path||"/readyz")}"`),Ge(t,"threads",e.server.threads),Ge(t,"grace_period_seconds",e.server.grace_period_seconds),Ge(t,"graceful_shutdown_timeout_seconds",e.server.graceful_shutdown_timeout_seconds),t.push(`config_reload_debounce_ms = ${Math.max(0,e.server.config_reload_debounce_ms||0)}`),e.server.tls&&(t.push(""),t.push("[server.tls]"),t.push(`listen = "${Ae(e.server.tls.listen)}"`),t.push(`cert_path = "${Ae(e.server.tls.cert_path)}"`),t.push(`key_path = "${Ae(e.server.tls.key_path)}"`),t.push(`enable_h2 = ${$e(e.server.tls.enable_h2)}`)),t.push(""),t.push("[observability]"),t.push(`log_level = "${Ae(e.observability.log_level||"info")}"`),t.push(`access_log = ${$e(e.observability.access_log)}`),e.observability.prometheus_listen.trim()&&t.push(`prometheus_listen = "${Ae(e.observability.prometheus_listen)}"`);const l=e.routes.map(Dl);return l.length>0&&(t.push(""),t.push(l.join(`

`))),`${t.join(`
`)}
`},Ie=qt(Yt()),Ol=Kt(Ie,e=>Ml(e)),Pl=Kt(Ie,e=>{const t=[];return e.routes.length===0&&t.push("ต้องมี route อย่างน้อย 1 รายการ"),e.server.health_path.startsWith("/")||t.push("server.health_path ต้องขึ้นต้นด้วย /"),e.server.ready_path.startsWith("/")||t.push("server.ready_path ต้องขึ้นต้นด้วย /"),e.server.health_path===e.server.ready_path&&t.push("server.health_path และ server.ready_path ต้องไม่เหมือนกัน"),e.server.tls&&(e.server.tls.listen.trim()||t.push("server.tls.listen ห้ามว่าง"),e.server.tls.cert_path.trim()||t.push("server.tls.cert_path ห้ามว่าง"),e.server.tls.key_path.trim()||t.push("server.tls.key_path ห้ามว่าง")),e.routes.filter(s=>s.is_default).length>1&&t.push("กำหนด route ที่เป็น default ได้เพียง 1 รายการ"),e.routes.forEach((s,a)=>{s.path_prefix.startsWith("/")||t.push(`Route #${a+1}: path_prefix ต้องขึ้นต้นด้วย /`),s.upstreams.length===0&&t.push(`Route #${a+1}: ต้องมี upstream อย่างน้อย 1 รายการ`),s.circuit_breaker.enabled&&(s.circuit_breaker.consecutive_failures<=0&&t.push(`Route #${a+1}: circuit_breaker.consecutive_failures ต้องมากกว่า 0`),s.circuit_breaker.open_ms<=0&&t.push(`Route #${a+1}: circuit_breaker.open_ms ต้องมากกว่า 0`)),s.upstreams.forEach((r,o)=>{r.addr.trim()||t.push(`Route #${a+1} Upstream #${o+1}: addr ห้ามว่าง`),(r.weight<1||r.weight>256)&&t.push(`Route #${a+1} Upstream #${o+1}: weight ต้องอยู่ในช่วง 1..256`)})}),t}),jl=()=>{Ie.update(e=>(e.routes.push(ft(e.routes.length+1)),e))},Hl=e=>{Ie.update(t=>(t.routes.splice(e,1),t.routes.length===0&&t.routes.push(ft(1)),t))},Ul=e=>{Ie.update(t=>{var l;return(l=t.routes[e])==null||l.upstreams.push(ut()),t})},Bl=(e,t)=>{Ie.update(l=>{const s=l.routes[e];return s&&(s.upstreams.splice(t,1),s.upstreams.length===0&&s.upstreams.push(ut())),l})};function Rt(e,t,l){const s=e.slice();return s[36]=t[l],s[38]=l,s}function Et(e,t,l){const s=e.slice();return s[39]=t[l],s}function At(e){let t,l=e[39]+"",s;return{c(){t=d("option"),s=E(l),t.__value=e[39],Jt(t,t.__value)},m(a,r){U(a,t,r),n(t,s)},p:te,d(a){a&&j(t)}}}function Nt(e){let t,l,s;return{c(){t=d("button"),t.textContent="Add Upstream",i(t,"class","rounded-lg border border-cyan-400/40 bg-cyan-500/10 px-3 py-1.5 text-sm font-medium text-cyan-200 hover:bg-cyan-500/20")},m(a,r){U(a,t,r),l||(s=H(t,"click",e[22]),l=!0)},p:te,d(a){a&&j(t),l=!1,s()}}}function Lt(e){let t,l,s;function a(){return e[23](e[38])}return{c(){t=d("button"),t.textContent="Remove",i(t,"class","rounded-md border border-rose-400/40 bg-rose-500/10 px-2 py-1 text-xs font-medium text-rose-200 hover:bg-rose-500/20")},m(r,o){U(r,t,o),l||(s=H(t,"click",a),l=!0)},p(r,o){e=r},d(r){r&&j(t),l=!1,s()}}}function Dt(e){let t,l,s,a,r,o,f,u,c,_,p,m,x,h,S,v,b,I,w,L,M,D,N,k,P,T,O,G,ce,q,ie,oe,Z,ue,re,$,W,se,y,R,V,ne,fe,Q,ge,A,z,K,J,Ee,ve,_e,Te,be,he,We,ye,ke,de,we,xe,Ne,Pe,X=!e[3]&&Lt(e);function je(...F){return e[24](e[38],...F)}function Ve(...F){return e[25](e[38],...F)}function me(...F){return e[26](e[38],...F)}function Le(...F){return e[27](e[38],...F)}function Me(...F){return e[28](e[38],...F)}function Se(...F){return e[29](e[38],...F)}function Xe(...F){return e[30](e[38],...F)}function He(...F){return e[31](e[38],...F)}function Ce(...F){return e[32](e[38],...F)}function Oe(...F){return e[33](e[38],...F)}function pe(...F){return e[34](e[38],...F)}return{c(){t=d("article"),l=d("div"),s=d("span"),s.textContent=`#${e[38]+1}`,a=g(),X&&X.c(),r=g(),o=d("div"),f=d("label"),u=E(`Address
            `),c=d("input"),p=g(),m=d("label"),x=E(`SNI
            `),h=d("input"),v=g(),b=d("label"),I=E(`Weight
            `),w=d("input"),M=g(),D=d("label"),N=d("input"),P=E(`
            TLS Enabled`),T=g(),O=d("label"),G=d("input"),q=E(`
            verify_cert`),ie=g(),oe=d("label"),Z=d("input"),re=E(`
            verify_hostname`),$=g(),W=d("label"),se=E(`connect_timeout_ms
            `),y=d("input"),V=g(),ne=d("label"),fe=E(`total_connect_timeout_ms
            `),Q=d("input"),A=g(),z=d("label"),K=E(`read_timeout_ms
            `),J=d("input"),ve=g(),_e=d("label"),Te=E(`write_timeout_ms
            `),be=d("input"),We=g(),ye=d("label"),ke=E(`idle_timeout_ms
            `),de=d("input"),xe=g(),i(s,"class","text-sm font-semibold text-slate-200"),i(l,"class","mb-3 flex items-center justify-between"),i(c,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),c.disabled=e[3],c.value=_=e[36].addr,i(f,"class","text-sm text-slate-300"),i(h,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),h.disabled=e[3],h.value=S=e[36].sni,i(m,"class","text-sm text-slate-300"),i(w,"type","number"),i(w,"min","1"),i(w,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),w.disabled=e[3],w.value=L=e[36].weight,i(b,"class","text-sm text-slate-300"),i(N,"type","checkbox"),N.disabled=e[3],N.checked=k=e[36].tls,i(D,"class","mt-7 flex items-center gap-2 text-sm text-slate-300"),i(G,"type","checkbox"),G.disabled=e[3],G.checked=ce=e[36].verify_cert??!0,i(O,"class","flex items-center gap-2 text-sm text-slate-300 md:mt-7"),i(Z,"type","checkbox"),Z.disabled=e[3],Z.checked=ue=e[36].verify_hostname??!0,i(oe,"class","flex items-center gap-2 text-sm text-slate-300 md:mt-7"),i(y,"type","number"),i(y,"min","0"),i(y,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),y.disabled=e[3],y.value=R=e[36].connect_timeout_ms??"",i(W,"class","text-sm text-slate-300"),i(Q,"type","number"),i(Q,"min","0"),i(Q,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),Q.disabled=e[3],Q.value=ge=e[36].total_connect_timeout_ms??"",i(ne,"class","text-sm text-slate-300"),i(J,"type","number"),i(J,"min","0"),i(J,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),J.disabled=e[3],J.value=Ee=e[36].read_timeout_ms??"",i(z,"class","text-sm text-slate-300"),i(be,"type","number"),i(be,"min","0"),i(be,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),be.disabled=e[3],be.value=he=e[36].write_timeout_ms??"",i(_e,"class","text-sm text-slate-300"),i(de,"type","number"),i(de,"min","0"),i(de,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),de.disabled=e[3],de.value=we=e[36].idle_timeout_ms??"",i(ye,"class","text-sm text-slate-300"),i(o,"class","grid gap-3 md:grid-cols-2"),i(t,"class","rounded-xl border border-slate-700 bg-slate-900/40 p-3")},m(F,C){U(F,t,C),n(t,l),n(l,s),n(l,a),X&&X.m(l,null),n(t,r),n(t,o),n(o,f),n(f,u),n(f,c),n(o,p),n(o,m),n(m,x),n(m,h),n(o,v),n(o,b),n(b,I),n(b,w),n(o,M),n(o,D),n(D,N),n(D,P),n(o,T),n(o,O),n(O,G),n(O,q),n(o,ie),n(o,oe),n(oe,Z),n(oe,re),n(o,$),n(o,W),n(W,se),n(W,y),n(o,V),n(o,ne),n(ne,fe),n(ne,Q),n(o,A),n(o,z),n(z,K),n(z,J),n(o,ve),n(o,_e),n(_e,Te),n(_e,be),n(o,We),n(o,ye),n(ye,ke),n(ye,de),n(t,xe),Ne||(Pe=[H(c,"input",je),H(h,"input",Ve),H(w,"input",me),H(N,"change",Le),H(G,"change",Me),H(Z,"change",Se),H(y,"input",Xe),H(Q,"input",He),H(J,"input",Ce),H(be,"input",Oe),H(de,"input",pe)],Ne=!0)},p(F,C){e=F,e[3]?X&&(X.d(1),X=null):X?X.p(e,C):(X=Lt(e),X.c(),X.m(l,null)),C[0]&8&&(c.disabled=e[3]),C[0]&17&&_!==(_=e[36].addr)&&c.value!==_&&(c.value=_),C[0]&8&&(h.disabled=e[3]),C[0]&17&&S!==(S=e[36].sni)&&h.value!==S&&(h.value=S),C[0]&8&&(w.disabled=e[3]),C[0]&17&&L!==(L=e[36].weight)&&w.value!==L&&(w.value=L),C[0]&8&&(N.disabled=e[3]),C[0]&17&&k!==(k=e[36].tls)&&(N.checked=k),C[0]&8&&(G.disabled=e[3]),C[0]&17&&ce!==(ce=e[36].verify_cert??!0)&&(G.checked=ce),C[0]&8&&(Z.disabled=e[3]),C[0]&17&&ue!==(ue=e[36].verify_hostname??!0)&&(Z.checked=ue),C[0]&8&&(y.disabled=e[3]),C[0]&17&&R!==(R=e[36].connect_timeout_ms??"")&&y.value!==R&&(y.value=R),C[0]&8&&(Q.disabled=e[3]),C[0]&17&&ge!==(ge=e[36].total_connect_timeout_ms??"")&&Q.value!==ge&&(Q.value=ge),C[0]&8&&(J.disabled=e[3]),C[0]&17&&Ee!==(Ee=e[36].read_timeout_ms??"")&&J.value!==Ee&&(J.value=Ee),C[0]&8&&(be.disabled=e[3]),C[0]&17&&he!==(he=e[36].write_timeout_ms??"")&&be.value!==he&&(be.value=he),C[0]&8&&(de.disabled=e[3]),C[0]&17&&we!==(we=e[36].idle_timeout_ms??"")&&de.value!==we&&(de.value=we)},d(F){F&&j(t),X&&X.d(),Ne=!1,Re(Pe)}}}function Vl(e){let t,l,s,a,r=e[1]+1+"",o,f,u=e[2].toUpperCase()+"",c,_,p,m,x,h,S,v,b,I,w,L,M,D,N,k,P,T,O,G,ce,q,ie,oe,Z,ue,re,$,W,se,y,R,V,ne,fe,Q,ge,A,z,K,J,Ee,ve,_e,Te,be,he,We,ye,ke,de,we,xe,Ne,Pe,X,je,Ve,me,Le,Me,Se,Xe,He,Ce,Oe=Be(e[4]),pe=[];for(let B=0;B<Oe.length;B+=1)pe[B]=At(Et(e,Oe,B));let F=!e[3]&&Nt(e),C=Be(e[0].upstreams),Y=[];for(let B=0;B<C.length;B+=1)Y[B]=Dt(Rt(e,C,B));return{c(){t=d("section"),l=d("div"),s=d("h3"),a=E("Route #"),o=E(r),f=E(" ("),c=E(u),_=E(")"),p=g(),m=d("div"),x=d("label"),h=E(`Name
      `),S=d("input"),b=g(),I=d("label"),w=E(`Host (optional)
      `),L=d("input"),D=g(),N=d("label"),k=E(`Path Prefix
      `),P=d("input"),O=g(),G=d("label"),ce=E(`LB Strategy
      `),q=d("select");for(let B=0;B<pe.length;B+=1)pe[B].c();oe=g(),Z=d("label"),ue=E(`Max Retries
      `),re=d("input"),W=g(),se=d("label"),y=E(`Retry Backoff (ms)
      `),R=d("input"),ne=g(),fe=d("label"),Q=d("input"),A=E(`
    Default Route`),z=g(),K=d("div"),J=d("h4"),J.textContent="Circuit Breaker",Ee=g(),ve=d("div"),_e=d("label"),Te=d("input"),he=E(`
        Enabled`),We=g(),ye=d("label"),ke=E(`Consecutive Failures
        `),de=d("input"),xe=g(),Ne=d("label"),Pe=E(`Open (ms)
        `),X=d("input"),Ve=g(),me=d("div"),Le=d("div"),Me=d("h4"),Me.textContent="Upstreams",Se=g(),F&&F.c(),Xe=g();for(let B=0;B<Y.length;B+=1)Y[B].c();i(s,"class","text-lg font-semibold text-slate-100"),i(l,"class","mb-4 flex items-center justify-between gap-4"),i(S,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),S.disabled=e[3],S.value=v=e[0].name,i(x,"class","text-sm text-slate-300"),i(L,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),L.disabled=e[3],L.value=M=e[0].host,i(I,"class","text-sm text-slate-300"),i(P,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),P.disabled=e[3],P.value=T=e[0].path_prefix,i(N,"class","text-sm text-slate-300"),i(q,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),q.disabled=e[3],i(G,"class","text-sm text-slate-300"),i(re,"type","number"),i(re,"min","0"),i(re,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),re.disabled=e[3],re.value=$=e[0].max_retries,i(Z,"class","text-sm text-slate-300"),i(R,"type","number"),i(R,"min","0"),i(R,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),R.disabled=e[3],R.value=V=e[0].retry_backoff_ms,i(se,"class","text-sm text-slate-300"),i(m,"class","grid gap-3 md:grid-cols-2"),i(Q,"type","checkbox"),Q.disabled=e[3],Q.checked=ge=e[0].is_default,i(fe,"class","mt-3 flex items-center gap-2 text-sm text-slate-300"),i(J,"class","text-sm font-semibold uppercase tracking-wide text-slate-200"),i(Te,"type","checkbox"),Te.disabled=e[3],Te.checked=be=e[0].circuit_breaker.enabled,i(_e,"class","flex items-center gap-2 text-sm text-slate-300 md:mt-7"),i(de,"type","number"),i(de,"min","1"),i(de,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),de.disabled=e[3],de.value=we=e[0].circuit_breaker.consecutive_failures,i(ye,"class","text-sm text-slate-300"),i(X,"type","number"),i(X,"min","1"),i(X,"class","mt-1 w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:bg-slate-800/70 disabled:text-slate-400"),X.disabled=e[3],X.value=je=e[0].circuit_breaker.open_ms,i(Ne,"class","text-sm text-slate-300"),i(ve,"class","mt-2 grid gap-3 md:grid-cols-3"),i(K,"class","mt-4 rounded-xl border border-slate-700 bg-slate-900/40 p-3"),i(Me,"class","text-sm font-semibold uppercase tracking-wide text-slate-200"),i(Le,"class","flex items-center justify-between"),i(me,"class","mt-5 space-y-3"),i(t,"class","rounded-2xl border border-slate-700 bg-slate-950/70 p-5")},m(B,ae){U(B,t,ae),n(t,l),n(l,s),n(s,a),n(s,o),n(s,f),n(s,c),n(s,_),n(t,p),n(t,m),n(m,x),n(x,h),n(x,S),n(m,b),n(m,I),n(I,w),n(I,L),n(m,D),n(m,N),n(N,k),n(N,P),n(m,O),n(m,G),n(G,ce),n(G,q);for(let ee=0;ee<pe.length;ee+=1)pe[ee]&&pe[ee].m(q,null);ct(q,e[0].lb),n(m,oe),n(m,Z),n(Z,ue),n(Z,re),n(m,W),n(m,se),n(se,y),n(se,R),n(t,ne),n(t,fe),n(fe,Q),n(fe,A),n(t,z),n(t,K),n(K,J),n(K,Ee),n(K,ve),n(ve,_e),n(_e,Te),n(_e,he),n(ve,We),n(ve,ye),n(ye,ke),n(ye,de),n(ve,xe),n(ve,Ne),n(Ne,Pe),n(Ne,X),n(t,Ve),n(t,me),n(me,Le),n(Le,Me),n(Le,Se),F&&F.m(Le,null),n(me,Xe);for(let ee=0;ee<Y.length;ee+=1)Y[ee]&&Y[ee].m(me,null);He||(Ce=[H(S,"input",e[13]),H(L,"input",e[14]),H(P,"input",e[15]),H(q,"change",e[9]),H(re,"input",e[16]),H(R,"input",e[17]),H(Q,"change",e[18]),H(Te,"change",e[19]),H(de,"input",e[20]),H(X,"input",e[21])],He=!0)},p(B,ae){if(ae[0]&2&&r!==(r=B[1]+1+"")&&le(o,r),ae[0]&4&&u!==(u=B[2].toUpperCase()+"")&&le(c,u),ae[0]&8&&(S.disabled=B[3]),ae[0]&17&&v!==(v=B[0].name)&&S.value!==v&&(S.value=v),ae[0]&8&&(L.disabled=B[3]),ae[0]&17&&M!==(M=B[0].host)&&L.value!==M&&(L.value=M),ae[0]&8&&(P.disabled=B[3]),ae[0]&17&&T!==(T=B[0].path_prefix)&&P.value!==T&&(P.value=T),ae[0]&16){Oe=Be(B[4]);let ee;for(ee=0;ee<Oe.length;ee+=1){const rt=Et(B,Oe,ee);pe[ee]?pe[ee].p(rt,ae):(pe[ee]=At(rt),pe[ee].c(),pe[ee].m(q,null))}for(;ee<pe.length;ee+=1)pe[ee].d(1);pe.length=Oe.length}if(ae[0]&8&&(q.disabled=B[3]),ae[0]&17&&ie!==(ie=B[0].lb)&&ct(q,B[0].lb),ae[0]&8&&(re.disabled=B[3]),ae[0]&17&&$!==($=B[0].max_retries)&&re.value!==$&&(re.value=$),ae[0]&8&&(R.disabled=B[3]),ae[0]&17&&V!==(V=B[0].retry_backoff_ms)&&R.value!==V&&(R.value=V),ae[0]&8&&(Q.disabled=B[3]),ae[0]&17&&ge!==(ge=B[0].is_default)&&(Q.checked=ge),ae[0]&8&&(Te.disabled=B[3]),ae[0]&17&&be!==(be=B[0].circuit_breaker.enabled)&&(Te.checked=be),ae[0]&8&&(de.disabled=B[3]),ae[0]&17&&we!==(we=B[0].circuit_breaker.consecutive_failures)&&de.value!==we&&(de.value=we),ae[0]&8&&(X.disabled=B[3]),ae[0]&17&&je!==(je=B[0].circuit_breaker.open_ms)&&X.value!==je&&(X.value=je),B[3]?F&&(F.d(1),F=null):F?F.p(B,ae):(F=Nt(B),F.c(),F.m(Le,null)),ae[0]&5355){C=Be(B[0].upstreams);let ee;for(ee=0;ee<C.length;ee+=1){const rt=Rt(B,C,ee);Y[ee]?Y[ee].p(rt,ae):(Y[ee]=Dt(rt),Y[ee].c(),Y[ee].m(me,null))}for(;ee<Y.length;ee+=1)Y[ee].d(1);Y.length=C.length}},i:te,o:te,d(B){B&&j(t),ot(pe,B),F&&F.d(),ot(Y,B),He=!1,Re(Ce)}}}function Fl(e,t,l){let s,{route:a}=t,{routeIndex:r}=t,{mode:o="edit"}=t;const f=["round_robin","random","hash"],u=y=>y.currentTarget.value,c=(y,R=0)=>Number(y.currentTarget.value||R),_=y=>y.currentTarget.checked,p=y=>y.currentTarget.value,m=(y,R)=>{Ie.update(V=>{const ne=V.routes[r];return ne&&(ne[y]=R),V})},x=y=>{m("lb",p(y))},h=y=>{const R=y.trim();if(!R)return null;const V=Number(R);return Number.isFinite(V)?Math.max(0,Math.floor(V)):null},S=(y,R)=>{Ie.update(V=>{const ne=V.routes[r];return ne&&(y==="enabled"?ne.circuit_breaker.enabled=!!R:y==="consecutive_failures"?ne.circuit_breaker.consecutive_failures=Math.max(1,Number(R)):ne.circuit_breaker.open_ms=Math.max(1,Number(R))),V})},v=(y,R,V)=>{Ie.update(ne=>{var Q;const fe=(Q=ne.routes[r])==null?void 0:Q.upstreams[y];return fe&&(R==="weight"&&typeof V=="number"?fe.weight=Math.min(256,Math.max(1,V)):R==="tls"&&typeof V=="boolean"?fe.tls=V:((R==="verify_cert"||R==="verify_hostname")&&typeof V=="boolean"||(R==="connect_timeout_ms"||R==="total_connect_timeout_ms"||R==="read_timeout_ms"||R==="write_timeout_ms"||R==="idle_timeout_ms")&&(typeof V=="number"||V===null)||(R==="addr"||R==="sni")&&typeof V=="string")&&(fe[R]=V)),ne})},b=y=>m("name",u(y)),I=y=>m("host",u(y)),w=y=>m("path_prefix",u(y)),L=y=>m("max_retries",c(y)),M=y=>m("retry_backoff_ms",c(y)),D=y=>m("is_default",_(y)),N=y=>S("enabled",_(y)),k=y=>S("consecutive_failures",c(y,1)),P=y=>S("open_ms",c(y,1)),T=()=>Ul(r),O=y=>Bl(r,y),G=(y,R)=>v(y,"addr",u(R)),ce=(y,R)=>v(y,"sni",u(R)),q=(y,R)=>v(y,"weight",c(R,1)),ie=(y,R)=>v(y,"tls",_(R)),oe=(y,R)=>v(y,"verify_cert",_(R)),Z=(y,R)=>v(y,"verify_hostname",_(R)),ue=(y,R)=>v(y,"connect_timeout_ms",h(u(R))),re=(y,R)=>v(y,"total_connect_timeout_ms",h(u(R))),$=(y,R)=>v(y,"read_timeout_ms",h(u(R))),W=(y,R)=>v(y,"write_timeout_ms",h(u(R))),se=(y,R)=>v(y,"idle_timeout_ms",h(u(R)));return e.$$set=y=>{"route"in y&&l(0,a=y.route),"routeIndex"in y&&l(1,r=y.routeIndex),"mode"in y&&l(2,o=y.mode)},e.$$.update=()=>{e.$$.dirty[0]&4&&l(3,s=o==="view")},[a,r,o,s,f,u,c,_,m,x,h,S,v,b,I,w,L,M,D,N,k,P,T,O,G,ce,q,ie,oe,Z,ue,re,$,W,se]}class zl extends Ke{constructor(t){super(),qe(this,t,Fl,Vl,ze,{route:0,routeIndex:1,mode:2},null,[-1,-1])}}function Mt(e){let t,l,s;return{c(){t=d("button"),t.textContent="Close",i(t,"class","rounded-md border border-slate-600 bg-slate-900 px-2.5 py-1 text-xs font-semibold text-slate-200 hover:bg-slate-800")},m(a,r){U(a,t,r),l||(s=H(t,"click",e[4]),l=!0)},p:te,d(a){a&&j(t),l=!1,s()}}}function Wl(e){let t;return{c(){t=d("div"),t.textContent="Select a route from the table, then click View or Edit.",i(t,"class","rounded-xl border border-dashed border-slate-600 bg-slate-950/60 px-4 py-10 text-center text-sm text-slate-400")},m(l,s){U(l,t,s)},p:te,i:te,o:te,d(l){l&&j(t)}}}function Jl(e){let t,l;return t=new zl({props:{route:e[0],routeIndex:e[1],mode:e[2]}}),{c(){Ye(t.$$.fragment)},m(s,a){Je(t,s,a),l=!0},p(s,a){const r={};a&1&&(r.route=s[0]),a&2&&(r.routeIndex=s[1]),a&4&&(r.mode=s[2]),t.$set(r)},i(s){l||(Ue(t.$$.fragment,s),l=!0)},o(s){Fe(t.$$.fragment,s),l=!1},d(s){Qe(t,s)}}}function Ql(e){let t,l,s,a,r,o,f,u,c=e[0]&&Mt(e);const _=[Jl,Wl],p=[];function m(x,h){return x[0]?0:1}return o=m(e),f=p[o]=_[o](e),{c(){t=d("article"),l=d("div"),s=d("h2"),s.textContent="Route Detail",a=g(),c&&c.c(),r=g(),f.c(),i(s,"class","text-base font-bold text-slate-100"),i(l,"class","mb-3 flex items-center justify-between"),i(t,"class","rounded-2xl border border-slate-700/80 bg-slate-900/80 p-4 backdrop-blur")},m(x,h){U(x,t,h),n(t,l),n(l,s),n(l,a),c&&c.m(l,null),n(t,r),p[o].m(t,null),u=!0},p(x,[h]){x[0]?c?c.p(x,h):(c=Mt(x),c.c(),c.m(l,null)):c&&(c.d(1),c=null);let S=o;o=m(x),o===S?p[o].p(x,h):(fl(),Fe(p[S],1,1,()=>{p[S]=null}),_l(),f=p[o],f?f.p(x,h):(f=p[o]=_[o](x),f.c()),Ue(f,1),f.m(t,null))},i(x){u||(Ue(f),u=!0)},o(x){Fe(f),u=!1},d(x){x&&j(t),c&&c.d(),p[o].d()}}}function Gl(e,t,l){let{route:s=null}=t,{routeIndex:a=0}=t,{mode:r="view"}=t;const o=nt(),f=()=>o("close");return e.$$set=u=>{"route"in u&&l(0,s=u.route),"routeIndex"in u&&l(1,a=u.routeIndex),"mode"in u&&l(2,r=u.mode)},[s,a,r,o,f]}class ql extends Ke{constructor(t){super(),qe(this,t,Gl,Ql,ze,{route:0,routeIndex:1,mode:2})}}function Ot(e,t,l){const s=e.slice();return s[21]=t[l],s}function Pt(e,t,l){const s=e.slice();return s[24]=t[l],s[26]=l,s}function jt(e){let t,l,s;return{c(){t=d("div"),l=E("Health check failed: "),s=E(e[4]),i(t,"class","mb-3 rounded-lg border border-rose-400/40 bg-rose-500/10 px-3 py-2 text-xs font-medium text-rose-200")},m(a,r){U(a,t,r),n(t,l),n(t,s)},p(a,r){r&16&&le(s,a[4])},d(a){a&&j(t)}}}function Kl(e){let t,l=Be(e[1]),s=[];for(let a=0;a<l.length;a+=1)s[a]=Bt(Ot(e,l,a));return{c(){for(let a=0;a<s.length;a+=1)s[a].c();t=vt()},m(a,r){for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(a,r);U(a,t,r)},p(a,r){if(r&8102){l=Be(a[1]);let o;for(o=0;o<l.length;o+=1){const f=Ot(a,l,o);s[o]?s[o].p(f,r):(s[o]=Bt(f),s[o].c(),s[o].m(t.parentNode,t))}for(;o<s.length;o+=1)s[o].d(1);s.length=l.length}},d(a){a&&j(t),ot(s,a)}}}function Xl(e){let t;return{c(){t=d("tr"),t.innerHTML='<td class="px-4 py-6 text-center text-sm text-slate-400" colspan="7">No routes found.</td>'},m(l,s){U(l,t,s)},p:te,d(l){l&&j(t)}}}function Ht(e){let t;return{c(){t=d("span"),t.textContent="default",i(t,"class","ml-2 rounded-full border border-emerald-400/40 bg-emerald-500/10 px-2 py-0.5 text-xs font-semibold text-emerald-200")},m(l,s){U(l,t,s)},d(l){l&&j(t)}}}function Yl(e){var a;let t,l=Be(((a=e[7](e[21]))==null?void 0:a.upstreams)??[]),s=[];for(let r=0;r<l.length;r+=1)s[r]=Ut(Pt(e,l,r));return{c(){for(let r=0;r<s.length;r+=1)s[r].c();t=vt()},m(r,o){for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(r,o);U(r,t,o)},p(r,o){var f;if(o&2178){l=Be(((f=r[7](r[21]))==null?void 0:f.upstreams)??[]);let u;for(u=0;u<l.length;u+=1){const c=Pt(r,l,u);s[u]?s[u].p(c,o):(s[u]=Ut(c),s[u].c(),s[u].m(t.parentNode,t))}for(;u<s.length;u+=1)s[u].d(1);s.length=l.length}},d(r){r&&j(t),ot(s,r)}}}function Zl(e){let t;return{c(){t=d("span"),t.textContent="n/a",i(t,"class","text-xs text-slate-500")},m(l,s){U(l,t,s)},p:te,d(l){l&&j(t)}}}function Ut(e){let t,l,s=e[26]+1+"",a,r,o=e[24].healthy?"UP":"DOWN",f,u,c,_;return{c(){t=d("span"),l=E("U"),a=E(s),r=E(":"),f=E(o),u=g(),i(t,"class",c=e[11](e[24].healthy)),i(t,"title",_=e[24].error??"")},m(p,m){U(p,t,m),n(t,l),n(t,a),n(t,r),n(t,f),n(t,u)},p(p,m){m&2&&o!==(o=p[24].healthy?"UP":"DOWN")&&le(f,o),m&2&&c!==(c=p[11](p[24].healthy))&&i(t,"class",c),m&2&&_!==(_=p[24].error??"")&&i(t,"title",_)},d(p){p&&j(t)}}}function Bt(e){let t,l,s=e[21].route.name+"",a,r,o,f,u=(e[21].route.host||"-")+"",c,_,p,m=e[21].route.path_prefix+"",x,h,S,v=e[21].route.lb+"",b,I,w,L,M=e[9](e[21])+"",D,N,k,P,T,O,G,ce,q,ie,oe,Z,ue,re,$,W,se,y,R,V=e[21].route.is_default&&Ht();function ne(K,J){return J&2&&(G=null),G==null&&(G=K[12](K[21]).length===0),G?Zl:Yl}let fe=ne(e,-1),Q=fe(e);function ge(){return e[17](e[21])}function A(){return e[18](e[21])}function z(){return e[19](e[21])}return{c(){t=d("tr"),l=d("td"),a=E(s),r=g(),V&&V.c(),o=g(),f=d("td"),c=E(u),_=g(),p=d("td"),x=E(m),h=g(),S=d("td"),b=E(v),I=g(),w=d("td"),L=d("span"),D=E(M),P=g(),T=d("td"),O=d("div"),Q.c(),ce=g(),q=d("td"),ie=d("div"),oe=d("button"),oe.textContent="View",Z=g(),ue=d("button"),ue.textContent="Edit",re=g(),$=d("button"),$.textContent="Delete",W=g(),i(l,"class","px-4 py-3 font-medium text-slate-100"),i(f,"class","px-4 py-3 text-slate-300"),i(p,"class","px-4 py-3 text-slate-300"),i(S,"class","px-4 py-3 text-slate-300"),i(L,"class",N=e[10](e[21])),i(L,"title",k=e[8](e[21])),i(w,"class","px-4 py-3"),i(O,"class","flex flex-wrap gap-1.5"),i(T,"class","px-4 py-3 text-slate-300"),i(oe,"class","rounded-md border border-slate-600 bg-slate-900 px-2.5 py-1 text-xs font-semibold text-slate-200 hover:bg-slate-800"),i(ue,"class","rounded-md border border-cyan-400/40 bg-cyan-500/10 px-2.5 py-1 text-xs font-semibold text-cyan-200 hover:bg-cyan-500/20"),i($,"class","rounded-md border border-rose-400/40 bg-rose-500/10 px-2.5 py-1 text-xs font-semibold text-rose-200 hover:bg-rose-500/20"),i(ie,"class","flex flex-wrap gap-2"),i(q,"class","px-4 py-3"),i(t,"class",se=e[2]===e[21].routeIndex?"bg-cyan-500/10":"hover:bg-slate-900/70")},m(K,J){U(K,t,J),n(t,l),n(l,a),n(l,r),V&&V.m(l,null),n(t,o),n(t,f),n(f,c),n(t,_),n(t,p),n(p,x),n(t,h),n(t,S),n(S,b),n(t,I),n(t,w),n(w,L),n(L,D),n(t,P),n(t,T),n(T,O),Q.m(O,null),n(t,ce),n(t,q),n(q,ie),n(ie,oe),n(ie,Z),n(ie,ue),n(ie,re),n(ie,$),n(t,W),y||(R=[H(oe,"click",ge),H(ue,"click",A),H($,"click",z)],y=!0)},p(K,J){e=K,J&2&&s!==(s=e[21].route.name+"")&&le(a,s),e[21].route.is_default?V||(V=Ht(),V.c(),V.m(l,null)):V&&(V.d(1),V=null),J&2&&u!==(u=(e[21].route.host||"-")+"")&&le(c,u),J&2&&m!==(m=e[21].route.path_prefix+"")&&le(x,m),J&2&&v!==(v=e[21].route.lb+"")&&le(b,v),J&2&&M!==(M=e[9](e[21])+"")&&le(D,M),J&2&&N!==(N=e[10](e[21]))&&i(L,"class",N),J&2&&k!==(k=e[8](e[21]))&&i(L,"title",k),fe===(fe=ne(e,J))&&Q?Q.p(e,J):(Q.d(1),Q=fe(e),Q&&(Q.c(),Q.m(O,null))),J&6&&se!==(se=e[2]===e[21].routeIndex?"bg-cyan-500/10":"hover:bg-slate-900/70")&&i(t,"class",se)},d(K){K&&j(t),V&&V.d(),Q.d(),y=!1,Re(R)}}}function $l(e){let t,l,s,a,r,o,f,u,c,_,p=e[3]?"Checking...":"Check Health",m,x,h,S,v,b,I,w,L,M,D,N=e[4]&&jt(e);function k(O,G){return O[1].length===0?Xl:Kl}let P=k(e),T=P(e);return{c(){t=d("article"),l=d("div"),s=d("h2"),s.textContent="Routes",a=g(),r=d("div"),o=d("input"),f=g(),u=d("button"),u.textContent="Add Route",c=g(),_=d("button"),m=E(p),x=g(),N&&N.c(),h=g(),S=d("div"),v=d("div"),b=d("table"),I=d("thead"),I.innerHTML='<tr><th class="px-4 py-3 text-left font-semibold">Route</th> <th class="px-4 py-3 text-left font-semibold">Host</th> <th class="px-4 py-3 text-left font-semibold">Path</th> <th class="px-4 py-3 text-left font-semibold">LB</th> <th class="px-4 py-3 text-left font-semibold">Health</th> <th class="px-4 py-3 text-left font-semibold">Upstreams</th> <th class="px-4 py-3 text-left font-semibold">Actions</th></tr>',w=g(),L=d("tbody"),T.c(),i(s,"class","text-base font-bold text-slate-100"),i(o,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 md:w-72"),i(o,"placeholder","Search route name / host / path / strategy"),o.value=e[0],i(u,"class","rounded-md border border-cyan-400/40 bg-cyan-500/10 px-3 py-2 text-xs font-semibold text-cyan-200 hover:bg-cyan-500/20"),i(_,"class","rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-60"),_.disabled=e[3],i(r,"class","flex w-full items-center gap-2 md:w-auto"),i(l,"class","mb-3 flex flex-wrap items-center justify-between gap-2"),i(I,"class","sticky top-0 z-10 bg-slate-900 text-slate-300"),i(L,"class","divide-y divide-slate-800"),i(b,"class","min-w-full divide-y divide-slate-800 text-sm"),i(v,"class","max-h-[46vh] overflow-auto"),i(S,"class","overflow-hidden rounded-xl border border-slate-700 bg-slate-950/70"),i(t,"class","rounded-2xl border border-slate-700/80 bg-slate-900/80 p-4 backdrop-blur")},m(O,G){U(O,t,G),n(t,l),n(l,s),n(l,a),n(l,r),n(r,o),n(r,f),n(r,u),n(r,c),n(r,_),n(_,m),n(t,x),N&&N.m(t,null),n(t,h),n(t,S),n(S,v),n(v,b),n(b,I),n(b,w),n(b,L),T.m(L,null),M||(D=[H(o,"input",e[14]),H(u,"click",e[15]),H(_,"click",e[16])],M=!0)},p(O,[G]){G&1&&o.value!==O[0]&&(o.value=O[0]),G&8&&p!==(p=O[3]?"Checking...":"Check Health")&&le(m,p),G&8&&(_.disabled=O[3]),O[4]?N?N.p(O,G):(N=jt(O),N.c(),N.m(t,h)):N&&(N.d(1),N=null),P===(P=k(O))&&T?T.p(O,G):(T.d(1),T=P(O),T&&(T.c(),T.m(L,null)))},i:te,o:te,d(O){O&&j(t),N&&N.d(),T.d(),M=!1,Re(D)}}}function es(e,t,l){let{routeQuery:s=""}=t,{rows:a=[]}=t,{selectedRouteIndex:r=null}=t,{routeHealthByIndex:o={}}=t,{healthLoading:f=!1}=t,{healthError:u=""}=t;const c=nt(),_=k=>k.currentTarget.value,p=k=>o[k.routeIndex]??null,m=k=>k.upstreams.map(P=>P.healthy?`${P.addr}: UP (${P.latency_ms??0}ms)`:`${P.addr}: DOWN (${P.error??"unreachable"})`).join(`
`),x=k=>{const P=p(k);return P?m(P):""},h=k=>{const P=p(k);return P?P.reachable_upstreams===0?"DOWN":P.reachable_upstreams<P.total_upstreams?"DEGRADED":P.healthy?"UP":"DEGRADED":"UNKNOWN"},S=k=>{const P=h(k);return P==="UP"?"rounded-full border border-emerald-400/40 bg-emerald-500/10 px-2 py-0.5 text-xs font-semibold text-emerald-200":P==="DEGRADED"?"rounded-full border border-amber-400/40 bg-amber-500/10 px-2 py-0.5 text-xs font-semibold text-amber-200":P==="DOWN"?"rounded-full border border-rose-400/40 bg-rose-500/10 px-2 py-0.5 text-xs font-semibold text-rose-200":"rounded-full border border-slate-500 bg-slate-800 px-2 py-0.5 text-xs font-semibold text-slate-300"},v=k=>k?"rounded border border-emerald-400/40 bg-emerald-500/10 px-1.5 py-0.5 text-[10px] font-semibold text-emerald-200":"rounded border border-rose-400/40 bg-rose-500/10 px-1.5 py-0.5 text-[10px] font-semibold text-rose-200",b=k=>{const P=p(k);return P?P.upstreams.map((T,O)=>T.healthy?`U${O+1}:UP`:`U${O+1}:DOWN`):[]},I=k=>c("search",_(k)),w=()=>c("addRoute"),L=()=>c("refreshHealth"),M=k=>c("view",k.routeIndex),D=k=>c("edit",k.routeIndex),N=k=>c("delete",k.routeIndex);return e.$$set=k=>{"routeQuery"in k&&l(0,s=k.routeQuery),"rows"in k&&l(1,a=k.rows),"selectedRouteIndex"in k&&l(2,r=k.selectedRouteIndex),"routeHealthByIndex"in k&&l(13,o=k.routeHealthByIndex),"healthLoading"in k&&l(3,f=k.healthLoading),"healthError"in k&&l(4,u=k.healthError)},[s,a,r,f,u,c,_,p,x,h,S,v,b,o,I,w,L,M,D,N]}class ts extends Ke{constructor(t){super(),qe(this,t,es,$l,ze,{routeQuery:0,rows:1,selectedRouteIndex:2,routeHealthByIndex:13,healthLoading:3,healthError:4})}}function ls(e){let t,l,s;return{c(){t=d("button"),t.textContent="Edit",i(t,"class","rounded-md border border-cyan-400/40 bg-cyan-500/10 px-3 py-1 text-xs font-semibold text-cyan-200 hover:bg-cyan-500/20")},m(a,r){U(a,t,r),l||(s=H(t,"click",e[5]),l=!0)},p:te,d(a){a&&j(t),l=!1,s()}}}function ss(e){let t,l,s,a,r,o;return{c(){t=d("div"),l=d("button"),l.textContent="Cancel",s=g(),a=d("button"),a.textContent="Save",i(l,"class","rounded-md border border-slate-600 bg-slate-900 px-3 py-1 text-xs font-semibold text-slate-200 hover:bg-slate-800"),i(a,"class","rounded-md border border-emerald-400/40 bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20"),i(t,"class","flex gap-2")},m(f,u){U(f,t,u),n(t,l),n(t,s),n(t,a),r||(o=[H(l,"click",e[6]),H(a,"click",e[8])],r=!0)},p:te,d(f){f&&j(t),r=!1,Re(o)}}}function ns(e){let t,l=e[0].listen.join(", ")+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].listen.join(", ")+"")&&le(s,l)},d(a){a&&j(t)}}}function rs(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),t.value=l=e[2].listen.join(", ")},m(r,o){U(r,t,o),s||(a=H(t,"input",e[9]),s=!0)},p(r,o){o&4&&l!==(l=r[2].listen.join(", "))&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function as(e){let t,l=e[0].health_path+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].health_path+"")&&le(s,l)},d(a){a&&j(t)}}}function os(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),t.value=l=e[2].health_path},m(r,o){U(r,t,o),s||(a=H(t,"input",e[10]),s=!0)},p(r,o){o&4&&l!==(l=r[2].health_path)&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function is(e){let t,l=e[0].ready_path+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].ready_path+"")&&le(s,l)},d(a){a&&j(t)}}}function us(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),t.value=l=e[2].ready_path},m(r,o){U(r,t,o),s||(a=H(t,"input",e[11]),s=!0)},p(r,o){o&4&&l!==(l=r[2].ready_path)&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function ds(e){let t,l=(e[0].threads??"-")+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=(a[0].threads??"-")+"")&&le(s,l)},d(a){a&&j(t)}}}function cs(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),i(t,"placeholder","null"),t.value=l=e[2].threads??""},m(r,o){U(r,t,o),s||(a=H(t,"input",e[12]),s=!0)},p(r,o){o&4&&l!==(l=r[2].threads??"")&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function fs(e){let t,l=(e[0].grace_period_seconds??"-")+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=(a[0].grace_period_seconds??"-")+"")&&le(s,l)},d(a){a&&j(t)}}}function _s(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),i(t,"placeholder","null"),t.value=l=e[2].grace_period_seconds??""},m(r,o){U(r,t,o),s||(a=H(t,"input",e[13]),s=!0)},p(r,o){o&4&&l!==(l=r[2].grace_period_seconds??"")&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function ps(e){let t,l=(e[0].graceful_shutdown_timeout_seconds??"-")+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=(a[0].graceful_shutdown_timeout_seconds??"-")+"")&&le(s,l)},d(a){a&&j(t)}}}function bs(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),i(t,"placeholder","null"),t.value=l=e[2].graceful_shutdown_timeout_seconds??""},m(r,o){U(r,t,o),s||(a=H(t,"input",e[14]),s=!0)},p(r,o){o&4&&l!==(l=r[2].graceful_shutdown_timeout_seconds??"")&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function ms(e){let t,l=e[0].config_reload_debounce_ms+"",s;return{c(){t=d("span"),s=E(l),i(t,"class","text-slate-300")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&1&&l!==(l=a[0].config_reload_debounce_ms+"")&&le(s,l)},d(a){a&&j(t)}}}function hs(e){let t,l,s,a;return{c(){t=d("input"),i(t,"class","w-full rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),t.value=l=e[2].config_reload_debounce_ms},m(r,o){U(r,t,o),s||(a=H(t,"input",e[15]),s=!0)},p(r,o){o&4&&l!==(l=r[2].config_reload_debounce_ms)&&t.value!==l&&(t.value=l)},d(r){r&&j(t),s=!1,a()}}}function gs(e){let t;return{c(){t=d("span"),t.textContent="disabled",i(t,"class","text-slate-300")},m(l,s){U(l,t,s)},p:te,d(l){l&&j(t)}}}function vs(e){let t,l,s,a=e[0].tls.listen+"",r,o,f,u,c=e[0].tls.cert_path+"",_,p,m,x,h=e[0].tls.key_path+"",S,v,b,I,w=e[0].tls.enable_h2?"true":"false",L;return{c(){t=d("div"),l=d("div"),s=E("listen: "),r=E(a),o=g(),f=d("div"),u=E("cert_path: "),_=E(c),p=g(),m=d("div"),x=E("key_path: "),S=E(h),v=g(),b=d("div"),I=E("enable_h2: "),L=E(w),i(t,"class","space-y-1 text-slate-300")},m(M,D){U(M,t,D),n(t,l),n(l,s),n(l,r),n(t,o),n(t,f),n(f,u),n(f,_),n(t,p),n(t,m),n(m,x),n(m,S),n(t,v),n(t,b),n(b,I),n(b,L)},p(M,D){D&1&&a!==(a=M[0].tls.listen+"")&&le(r,a),D&1&&c!==(c=M[0].tls.cert_path+"")&&le(_,c),D&1&&h!==(h=M[0].tls.key_path+"")&&le(S,h),D&1&&w!==(w=M[0].tls.enable_h2?"true":"false")&&le(L,w)},d(M){M&&j(t)}}}function ys(e){let t,l,s,a,r,o,f,u,c=e[2].tls&&Vt(e);return{c(){t=d("label"),l=d("input"),a=E(`
                Enable TLS`),r=g(),c&&c.c(),o=vt(),i(l,"type","checkbox"),l.checked=s=e[2].tls!==null,i(t,"class","mb-2 flex items-center gap-2 text-sm text-slate-300")},m(_,p){U(_,t,p),n(t,l),n(t,a),U(_,r,p),c&&c.m(_,p),U(_,o,p),f||(u=H(l,"change",e[16]),f=!0)},p(_,p){p&4&&s!==(s=_[2].tls!==null)&&(l.checked=s),_[2].tls?c?c.p(_,p):(c=Vt(_),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},d(_){_&&(j(t),j(r),j(o)),c&&c.d(_),f=!1,u()}}}function Vt(e){let t,l,s,a,r,o,f,u,c,_,p,m,x,h,S,v;return{c(){t=d("div"),l=d("input"),a=g(),r=d("label"),o=d("input"),u=E(`
                    enable_h2`),c=g(),_=d("input"),m=g(),x=d("input"),i(l,"class","rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500"),i(l,"placeholder","listen"),l.value=s=e[2].tls.listen,i(o,"type","checkbox"),o.checked=f=e[2].tls.enable_h2,i(r,"class","mt-2 flex items-center gap-2 text-sm text-slate-300"),i(_,"class","rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500 md:col-span-2"),i(_,"placeholder","cert_path"),_.value=p=e[2].tls.cert_path,i(x,"class","rounded-lg border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 placeholder:text-slate-500 md:col-span-2"),i(x,"placeholder","key_path"),x.value=h=e[2].tls.key_path,i(t,"class","grid gap-2 md:grid-cols-2")},m(b,I){U(b,t,I),n(t,l),n(t,a),n(t,r),n(r,o),n(r,u),n(t,c),n(t,_),n(t,m),n(t,x),S||(v=[H(l,"input",e[17]),H(o,"change",e[18]),H(_,"input",e[19]),H(x,"input",e[20])],S=!0)},p(b,I){I&4&&s!==(s=b[2].tls.listen)&&l.value!==s&&(l.value=s),I&4&&f!==(f=b[2].tls.enable_h2)&&(o.checked=f),I&4&&p!==(p=b[2].tls.cert_path)&&_.value!==p&&(_.value=p),I&4&&h!==(h=b[2].tls.key_path)&&x.value!==h&&(x.value=h)},d(b){b&&j(t),S=!1,Re(v)}}}function ks(e){let t,l,s,a,r,o,f,u,c,_,p,m,x,h,S,v,b,I,w,L,M,D,N,k,P,T,O,G,ce,q,ie,oe,Z,ue,re,$,W,se,y,R,V,ne,fe,Q,ge,A,z,K,J;function Ee(C,Y){return C[1]?ss:ls}let ve=Ee(e),_e=ve(e);function Te(C,Y){return C[1]?rs:ns}let be=Te(e),he=be(e);function We(C,Y){return C[1]?os:as}let ye=We(e),ke=ye(e);function de(C,Y){return C[1]?us:is}let we=de(e),xe=we(e);function Ne(C,Y){return C[1]?cs:ds}let Pe=Ne(e),X=Pe(e);function je(C,Y){return C[1]?_s:fs}let Ve=je(e),me=Ve(e);function Le(C,Y){return C[1]?bs:ps}let Me=Le(e),Se=Me(e);function Xe(C,Y){return C[1]?hs:ms}let He=Xe(e),Ce=He(e);function Oe(C,Y){return C[1]?ys:C[0].tls?vs:gs}let pe=Oe(e),F=pe(e);return{c(){t=d("article"),l=d("div"),s=d("h2"),s.textContent="Server",a=g(),_e.c(),r=g(),o=d("div"),f=d("table"),u=d("thead"),u.innerHTML='<tr><th class="w-52 px-4 py-3 text-left font-semibold">Key</th> <th class="px-4 py-3 text-left font-semibold">Value</th></tr>',c=g(),_=d("tbody"),p=d("tr"),m=d("td"),m.textContent="listen",x=g(),h=d("td"),he.c(),S=g(),v=d("tr"),b=d("td"),b.textContent="health_path",I=g(),w=d("td"),ke.c(),L=g(),M=d("tr"),D=d("td"),D.textContent="ready_path",N=g(),k=d("td"),xe.c(),P=g(),T=d("tr"),O=d("td"),O.textContent="threads",G=g(),ce=d("td"),X.c(),q=g(),ie=d("tr"),oe=d("td"),oe.textContent="grace_period_seconds",Z=g(),ue=d("td"),me.c(),re=g(),$=d("tr"),W=d("td"),W.textContent="graceful_shutdown_timeout_seconds",se=g(),y=d("td"),Se.c(),R=g(),V=d("tr"),ne=d("td"),ne.textContent="config_reload_debounce_ms",fe=g(),Q=d("td"),Ce.c(),ge=g(),A=d("tr"),z=d("td"),z.textContent="server.tls",K=g(),J=d("td"),F.c(),i(s,"class","text-base font-bold text-slate-100"),i(l,"class","mb-3 flex items-center justify-between gap-2"),i(u,"class","bg-slate-900 text-slate-300"),i(m,"class","px-4 py-3 font-medium text-slate-200"),i(h,"class","px-4 py-3"),i(b,"class","px-4 py-3 font-medium text-slate-200"),i(w,"class","px-4 py-3"),i(D,"class","px-4 py-3 font-medium text-slate-200"),i(k,"class","px-4 py-3"),i(O,"class","px-4 py-3 font-medium text-slate-200"),i(ce,"class","px-4 py-3"),i(oe,"class","px-4 py-3 font-medium text-slate-200"),i(ue,"class","px-4 py-3"),i(W,"class","px-4 py-3 font-medium text-slate-200"),i(y,"class","px-4 py-3"),i(ne,"class","px-4 py-3 font-medium text-slate-200"),i(Q,"class","px-4 py-3"),i(z,"class","px-4 py-3 font-medium text-slate-200 align-top"),i(J,"class","px-4 py-3"),i(_,"class","divide-y divide-slate-800"),i(f,"class","min-w-full divide-y divide-slate-800 text-sm"),i(o,"class","overflow-hidden rounded-xl border border-slate-700 bg-slate-950/70"),i(t,"class","rounded-2xl border border-slate-700/80 bg-slate-900/80 p-4 backdrop-blur")},m(C,Y){U(C,t,Y),n(t,l),n(l,s),n(l,a),_e.m(l,null),n(t,r),n(t,o),n(o,f),n(f,u),n(f,c),n(f,_),n(_,p),n(p,m),n(p,x),n(p,h),he.m(h,null),n(_,S),n(_,v),n(v,b),n(v,I),n(v,w),ke.m(w,null),n(_,L),n(_,M),n(M,D),n(M,N),n(M,k),xe.m(k,null),n(_,P),n(_,T),n(T,O),n(T,G),n(T,ce),X.m(ce,null),n(_,q),n(_,ie),n(ie,oe),n(ie,Z),n(ie,ue),me.m(ue,null),n(_,re),n(_,$),n($,W),n($,se),n($,y),Se.m(y,null),n(_,R),n(_,V),n(V,ne),n(V,fe),n(V,Q),Ce.m(Q,null),n(_,ge),n(_,A),n(A,z),n(A,K),n(A,J),F.m(J,null)},p(C,[Y]){ve===(ve=Ee(C))&&_e?_e.p(C,Y):(_e.d(1),_e=ve(C),_e&&(_e.c(),_e.m(l,null))),be===(be=Te(C))&&he?he.p(C,Y):(he.d(1),he=be(C),he&&(he.c(),he.m(h,null))),ye===(ye=We(C))&&ke?ke.p(C,Y):(ke.d(1),ke=ye(C),ke&&(ke.c(),ke.m(w,null))),we===(we=de(C))&&xe?xe.p(C,Y):(xe.d(1),xe=we(C),xe&&(xe.c(),xe.m(k,null))),Pe===(Pe=Ne(C))&&X?X.p(C,Y):(X.d(1),X=Pe(C),X&&(X.c(),X.m(ce,null))),Ve===(Ve=je(C))&&me?me.p(C,Y):(me.d(1),me=Ve(C),me&&(me.c(),me.m(ue,null))),Me===(Me=Le(C))&&Se?Se.p(C,Y):(Se.d(1),Se=Me(C),Se&&(Se.c(),Se.m(y,null))),He===(He=Xe(C))&&Ce?Ce.p(C,Y):(Ce.d(1),Ce=He(C),Ce&&(Ce.c(),Ce.m(Q,null))),pe===(pe=Oe(C))&&F?F.p(C,Y):(F.d(1),F=pe(C),F&&(F.c(),F.m(J,null)))},i:te,o:te,d(C){C&&j(t),_e.d(),he.d(),ke.d(),xe.d(),X.d(),me.d(),Se.d(),Ce.d(),F.d()}}}function ws(e,t,l){let{server:s}=t;const a=nt(),r=T=>T.currentTarget.value,o=T=>T.currentTarget.checked;let f=!1,u={listen:["0.0.0.0:8080"],health_path:"/healthz",ready_path:"/readyz",threads:null,grace_period_seconds:null,graceful_shutdown_timeout_seconds:null,config_reload_debounce_ms:250,tls:null};const c=T=>({...T,listen:[...T.listen],tls:T.tls?{...T.tls}:null}),_=()=>{l(2,u=c(s)),l(1,f=!0)},p=()=>{l(1,f=!1)},m=T=>{const O=T.trim();if(!O)return null;const G=Number(O);return Number.isFinite(G)?Math.max(0,Math.floor(G)):null},x=()=>{l(2,u.listen=u.listen.map(T=>T.trim()).filter(Boolean),u),u.listen.length===0&&l(2,u.listen=["0.0.0.0:8080"],u),u.tls&&(l(2,u.tls.listen=u.tls.listen.trim(),u),l(2,u.tls.cert_path=u.tls.cert_path.trim(),u),l(2,u.tls.key_path=u.tls.key_path.trim(),u)),a("save",c(u)),l(1,f=!1)},h=T=>l(2,u.listen=r(T).split(",").map(O=>O.trim()).filter(Boolean),u),S=T=>l(2,u.health_path=r(T),u),v=T=>l(2,u.ready_path=r(T),u),b=T=>l(2,u.threads=m(r(T)),u),I=T=>l(2,u.grace_period_seconds=m(r(T)),u),w=T=>l(2,u.graceful_shutdown_timeout_seconds=m(r(T)),u),L=T=>l(2,u.config_reload_debounce_ms=m(r(T))??0,u),M=T=>l(2,u.tls=o(T)?{listen:"0.0.0.0:8443",cert_path:"",key_path:"",enable_h2:!0}:null,u),D=T=>u.tls&&l(2,u.tls.listen=r(T),u),N=T=>u.tls&&l(2,u.tls.enable_h2=o(T),u),k=T=>u.tls&&l(2,u.tls.cert_path=r(T),u),P=T=>u.tls&&l(2,u.tls.key_path=r(T),u);return e.$$set=T=>{"server"in T&&l(0,s=T.server)},e.$$.update=()=>{e.$$.dirty&3&&(f||l(2,u=c(s)))},[s,f,u,r,o,_,p,m,x,h,S,v,b,I,w,L,M,D,N,k,P]}class xs extends Ke{constructor(t){super(),qe(this,t,ws,ks,ze,{server:0})}}function Ft(e){let t,l=e[2][0]+"",s;return{c(){t=d("div"),s=E(l),i(t,"class","mb-3 rounded-lg border border-rose-300/30 bg-rose-400/10 p-3 text-xs text-rose-100")},m(a,r){U(a,t,r),n(t,s)},p(a,r){r&4&&l!==(l=a[2][0]+"")&&le(s,l)},d(a){a&&j(t)}}}function Ss(e){let t,l,s,a,r,o=e[1]?"Copied":"Copy",f,u,c,_=e[3]?"VALIDATION: PASS":`VALIDATION: FAIL (${e[2].length} issue(s))`,p,m,x,h,S,v,b,I,w=!e[3]&&Ft(e);return{c(){t=d("article"),l=d("div"),s=d("h2"),s.textContent="TOML Preview",a=g(),r=d("button"),f=E(o),u=g(),c=d("div"),p=E(_),x=g(),w&&w.c(),h=g(),S=d("pre"),v=E(e[0]),i(s,"class","text-base font-bold"),i(r,"class","rounded-lg border border-cyan-300/40 bg-cyan-300/10 px-3 py-1.5 text-sm font-semibold text-cyan-100 hover:bg-cyan-300/20"),i(l,"class","mb-3 flex flex-wrap items-center justify-between gap-3"),i(c,"class",m=e[3]?"mb-3 w-full rounded-lg border border-emerald-300/40 bg-emerald-400/15 px-3 py-2 text-sm font-semibold text-emerald-200":"mb-3 w-full rounded-lg border border-rose-300/40 bg-rose-400/15 px-3 py-2 text-sm font-semibold text-rose-200"),i(S,"class","max-h-[36vh] overflow-auto rounded-xl bg-black/30 p-4 text-xs leading-6 md:text-sm"),i(t,"class","rounded-2xl border border-slate-700/80 bg-[#0f172a] p-4 text-slate-100")},m(L,M){U(L,t,M),n(t,l),n(l,s),n(l,a),n(l,r),n(r,f),n(t,u),n(t,c),n(c,p),n(t,x),w&&w.m(t,null),n(t,h),n(t,S),n(S,v),b||(I=H(r,"click",e[5]),b=!0)},p(L,[M]){M&2&&o!==(o=L[1]?"Copied":"Copy")&&le(f,o),M&12&&_!==(_=L[3]?"VALIDATION: PASS":`VALIDATION: FAIL (${L[2].length} issue(s))`)&&le(p,_),M&8&&m!==(m=L[3]?"mb-3 w-full rounded-lg border border-emerald-300/40 bg-emerald-400/15 px-3 py-2 text-sm font-semibold text-emerald-200":"mb-3 w-full rounded-lg border border-rose-300/40 bg-rose-400/15 px-3 py-2 text-sm font-semibold text-rose-200")&&i(c,"class",m),L[3]?w&&(w.d(1),w=null):w?w.p(L,M):(w=Ft(L),w.c(),w.m(t,h)),M&1&&le(v,L[0])},i:te,o:te,d(L){L&&j(t),w&&w.d(),b=!1,I()}}}function Cs(e,t,l){let s,{toml:a=""}=t,{copied:r=!1}=t,{issues:o=[]}=t;const f=nt(),u=()=>f("copy");return e.$$set=c=>{"toml"in c&&l(0,a=c.toml),"copied"in c&&l(1,r=c.copied),"issues"in c&&l(2,o=c.issues)},e.$$.update=()=>{e.$$.dirty&4&&l(3,s=o.length===0)},[a,r,o,s,f,u]}class Ts extends Ke{constructor(t){super(),qe(this,t,Cs,Ss,ze,{toml:0,copied:1,issues:2})}}const De=e=>{if(e==null||e==="")return null;const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null},Is=e=>e==="random"||e==="hash"||e==="round_robin"?e:"round_robin",Rs=e=>{const t=ut(),l=De(e.weight)??t.weight;return{...t,...e,addr:String(e.addr??t.addr),tls:e.tls??t.tls,sni:e.sni==null?"":String(e.sni),weight:Math.max(1,Math.min(256,l)),verify_cert:typeof e.verify_cert=="boolean"?e.verify_cert:t.verify_cert,verify_hostname:typeof e.verify_hostname=="boolean"?e.verify_hostname:t.verify_hostname,connect_timeout_ms:De(e.connect_timeout_ms),total_connect_timeout_ms:De(e.total_connect_timeout_ms),read_timeout_ms:De(e.read_timeout_ms),write_timeout_ms:De(e.write_timeout_ms),idle_timeout_ms:De(e.idle_timeout_ms)}},Es=(e,t)=>{const l=ft(t+1),s=Array.isArray(e.upstreams)&&e.upstreams.length>0?e.upstreams:Array.isArray(e.upstream)&&e.upstream.length>0?e.upstream:[ut()];return{...l,...e,name:String(e.name??l.name),host:e.host==null?"":String(e.host),path_prefix:String(e.path_prefix??l.path_prefix),is_default:e.is_default??l.is_default,lb:Is(e.lb),max_retries:De(e.max_retries)??l.max_retries,retry_backoff_ms:De(e.retry_backoff_ms)??l.retry_backoff_ms,circuit_breaker:{...Xt(),...e.circuit_breaker??{}},upstreams:s.map(Rs)}},Zt=e=>{var s,a,r,o,f,u,c,_,p,m,x,h;const t=Yt(),l=Array.isArray(e.routes)&&e.routes.length>0?e.routes:Array.isArray(e.route)&&e.route.length>0?e.route:t.routes;return{server:{...t.server,...e.server??{},listen:Array.isArray((s=e.server)==null?void 0:s.listen)&&e.server.listen.length>0?e.server.listen.map(S=>String(S).trim()).filter(Boolean):t.server.listen,health_path:String(((a=e.server)==null?void 0:a.health_path)??t.server.health_path),ready_path:String(((r=e.server)==null?void 0:r.ready_path)??t.server.ready_path),threads:De((o=e.server)==null?void 0:o.threads),grace_period_seconds:De((f=e.server)==null?void 0:f.grace_period_seconds),graceful_shutdown_timeout_seconds:De((u=e.server)==null?void 0:u.graceful_shutdown_timeout_seconds),config_reload_debounce_ms:De((c=e.server)==null?void 0:c.config_reload_debounce_ms)??t.server.config_reload_debounce_ms,tls:((_=e.server)==null?void 0:_.tls)===null?null:(p=e.server)!=null&&p.tls?{listen:String(e.server.tls.listen??"0.0.0.0:8443"),cert_path:String(e.server.tls.cert_path??""),key_path:String(e.server.tls.key_path??""),enable_h2:e.server.tls.enable_h2??!0}:t.server.tls},observability:{...t.observability,...e.observability??{},log_level:String(((m=e.observability)==null?void 0:m.log_level)??t.observability.log_level),access_log:((x=e.observability)==null?void 0:x.access_log)??t.observability.access_log,prometheus_listen:((h=e.observability)==null?void 0:h.prometheus_listen)==null?"":String(e.observability.prometheus_listen)},routes:l.map(Es)}},$t="/web/config",As="/web/health/routes",el=1e4,yt=async(e,t,l=el)=>{const s=new AbortController,a=window.setTimeout(()=>s.abort(),l);try{return await fetch(e,{...t,signal:s.signal})}finally{window.clearTimeout(a)}},tl=async(e,t)=>{const s=(await t.text()).trim()||t.statusText||"unknown_error";return new Error(`${e} failed (${t.status}): ${s}`)},Ns=async()=>{const e=await yt(`${$t}?format=json`,{method:"GET",headers:{Accept:"application/json"},cache:"no-store"});if(!e.ok)throw await tl("load_config",e);const t=await e.json();return Zt(t)},Ls=async e=>{const t=await yt($t,{method:"PUT",headers:{"Content-Type":"text/plain; charset=utf-8"},body:e}),l=(await t.text()).trim();if(!t.ok){const s=l||t.statusText||"unknown_error";throw new Error(`save_config failed (${t.status}): ${s}`)}return l||"config_applied"},Ds=async(e=1200,t)=>{const l=new URLSearchParams({timeout_ms:String(Math.max(100,Math.min(1e4,Math.floor(e))))}),s=t&&t.trim().length>0?"POST":"GET",a=await yt(`${As}?${l.toString()}`,{method:s,headers:{Accept:"application/json",...s==="POST"?{"Content-Type":"text/plain; charset=utf-8"}:{}},cache:"no-store",...s==="POST"?{body:t}:{}},el+e);if(!a.ok)throw await tl("load_route_health",a);return await a.json()};function Ms(e){let t,l,s,a,r,o,f,u,c,_,p,m,x,h,S,v;return l=new gl({props:{saveDisabled:e[10]||e[9]||e[17].length>0,reloadDisabled:e[10]||e[9],saving:e[10],loading:e[9],statusMessage:e[11],statusTone:e[12],lastSynced:e[13]}}),l.$on("saveToServer",e[20]),l.$on("reloadFromServer",e[18]),l.$on("exportJson",e[21]),l.$on("importJson",e[22]),o=new xs({props:{server:e[3].server}}),o.$on("save",e[23]),u=new El({props:{observability:e[3].observability}}),u.$on("change",e[24]),p=new ts({props:{routeQuery:e[1],rows:e[14],selectedRouteIndex:e[0],routeHealthByIndex:e[7],healthLoading:e[2],healthError:e[8]}}),p.$on("addRoute",e[27]),p.$on("refreshHealth",e[31]),p.$on("search",e[32]),p.$on("view",e[33]),p.$on("edit",e[34]),p.$on("delete",e[35]),x=new ql({props:{route:e[16],routeIndex:e[15],mode:e[6]}}),x.$on("close",e[29]),S=new Ts({props:{toml:e[4],issues:e[17],copied:e[5]}}),S.$on("copy",e[25]),{c(){t=d("main"),Ye(l.$$.fragment),s=g(),a=d("div"),r=d("div"),Ye(o.$$.fragment),f=g(),Ye(u.$$.fragment),c=g(),_=d("div"),Ye(p.$$.fragment),m=g(),Ye(x.$$.fragment),h=g(),Ye(S.$$.fragment),i(r,"class","grid gap-4 lg:grid-cols-2"),i(_,"class","grid gap-4 xl:grid-cols-2"),i(a,"class","mt-4 space-y-4"),i(t,"class","min-h-screen w-full px-3 py-3 text-slate-100 md:px-5")},m(b,I){U(b,t,I),Je(l,t,null),n(t,s),n(t,a),n(a,r),Je(o,r,null),n(r,f),Je(u,r,null),n(a,c),n(a,_),Je(p,_,null),n(_,m),Je(x,_,null),n(a,h),Je(S,a,null),v=!0},p(b,I){const w={};I[0]&132608&&(w.saveDisabled=b[10]||b[9]||b[17].length>0),I[0]&1536&&(w.reloadDisabled=b[10]||b[9]),I[0]&1024&&(w.saving=b[10]),I[0]&512&&(w.loading=b[9]),I[0]&2048&&(w.statusMessage=b[11]),I[0]&4096&&(w.statusTone=b[12]),I[0]&8192&&(w.lastSynced=b[13]),l.$set(w);const L={};I[0]&8&&(L.server=b[3].server),o.$set(L);const M={};I[0]&8&&(M.observability=b[3].observability),u.$set(M);const D={};I[0]&2&&(D.routeQuery=b[1]),I[0]&16384&&(D.rows=b[14]),I[0]&1&&(D.selectedRouteIndex=b[0]),I[0]&128&&(D.routeHealthByIndex=b[7]),I[0]&4&&(D.healthLoading=b[2]),I[0]&256&&(D.healthError=b[8]),p.$set(D);const N={};I[0]&65536&&(N.route=b[16]),I[0]&32768&&(N.routeIndex=b[15]),I[0]&64&&(N.mode=b[6]),x.$set(N);const k={};I[0]&16&&(k.toml=b[4]),I[0]&131072&&(k.issues=b[17]),I[0]&32&&(k.copied=b[5]),S.$set(k)},i(b){v||(Ue(l.$$.fragment,b),Ue(o.$$.fragment,b),Ue(u.$$.fragment,b),Ue(p.$$.fragment,b),Ue(x.$$.fragment,b),Ue(S.$$.fragment,b),v=!0)},o(b){Fe(l.$$.fragment,b),Fe(o.$$.fragment,b),Fe(u.$$.fragment,b),Fe(p.$$.fragment,b),Fe(x.$$.fragment,b),Fe(S.$$.fragment,b),v=!1},d(b){b&&j(t),Qe(l),Qe(o),Qe(u),Qe(p),Qe(x),Qe(S)}}}function Os(e,t,l){let s,a,r,o,f,u;pt(e,Ie,A=>l(3,o=A)),pt(e,Ol,A=>l(4,f=A)),pt(e,Pl,A=>l(17,u=A));let c=!1,_="view",p=null,m="",x={},h="",S=!1,v="",b=!1,I=!1,w="Ready",L="neutral",M="";const D=()=>new Intl.DateTimeFormat(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date),N=A=>A instanceof Error?A.message:String(A),k=(A,z="neutral")=>{l(11,w=A),l(12,L=z)},P=()=>{l(7,x={}),l(30,h=""),l(8,v="")},T=async()=>{if(b||I)return;l(9,b=!0);let A=!1;k("Loading config from admin API...");try{const z=await Ns();Ie.set(z),P(),p!==null&&p>=z.routes.length&&l(0,p=null),l(13,M=D()),k("Loaded config from admin API.","ok"),A=!0}catch(z){k(`Load failed: ${N(z)}`,"error")}finally{l(9,b=!1),A&&O()}},O=async()=>{if(S||b)return;const A=f;l(2,S=!0),l(8,v="");try{const z=await Ds(1200,A),K={};z.routes.forEach(J=>{K[J.route_index]=J}),l(7,x=K),l(30,h=A)}catch(z){l(8,v=N(z)),k(`Route health check failed: ${v}`,"error")}finally{l(2,S=!1)}},G=async()=>{if(!(I||b)){if(u.length>0){k(`Save blocked: validation failed (${u.length} issue(s)).`,"error");return}l(10,I=!0),k("Saving config to admin API...");try{const A=await Ls(f);l(13,M=D()),k(`Save successful: ${A}`,"ok"),O()}catch(A){k(`Save failed: ${N(A)}`,"error")}finally{l(10,I=!1)}}},ce=A=>{Ie.update(z=>(z.server=A,z))},q=(A,z)=>{Ie.update(K=>(K.observability[A]=z,K))},ie=()=>{const A=JSON.stringify(o,null,2),z=new Blob([A],{type:"application/json"}),K=URL.createObjectURL(z),J=document.createElement("a");J.href=K,J.download="prx-config.json",J.click(),URL.revokeObjectURL(K)},oe=async A=>{const z=A.currentTarget;if(!(!z.files||z.files.length===0))try{const J=await z.files[0].text(),Ee=JSON.parse(J);Ie.set(Zt(Ee)),P(),k("Imported JSON locally. Click Save to Server to apply.","neutral")}catch(K){k(`Import failed: ${N(K)}`,"error")}finally{z.value=""}},Z=A=>{oe(A.detail)},ue=A=>{ce(A.detail)},re=A=>{const{key:z,value:K}=A.detail;if(z==="access_log"){q("access_log",!!K);return}if(z==="log_level"){q("log_level",String(K));return}q("prometheus_listen",String(K))},$=async()=>{await navigator.clipboard.writeText(f),l(5,c=!0),setTimeout(()=>{l(5,c=!1)},1800)},W=(A,z)=>{l(0,p=A),l(6,_=z)},se=()=>{jl(),P(),l(0,p=o.routes.length-1),l(6,_="edit")},y=A=>{if(confirm("Delete this route?")){if(Hl(A),P(),o.routes.length===0){l(0,p=null);return}if(p===A){l(0,p=null);return}p!==null&&p>A&&l(0,p-=1)}},R=()=>{l(0,p=null)};ol(()=>{T()});const V=()=>void O(),ne=A=>l(1,m=A.detail),fe=A=>W(A.detail,"view"),Q=A=>W(A.detail,"edit"),ge=A=>y(A.detail);return e.$$.update=()=>{e.$$.dirty[0]&9&&l(16,s=p===null?null:o.routes[p]??null),e.$$.dirty[0]&1&&l(15,a=p??0),e.$$.dirty[0]&1073741844&&h&&!S&&f!==h&&P(),e.$$.dirty[0]&10&&l(14,r=o.routes.map((A,z)=>({route:A,routeIndex:z})).filter(({route:A})=>{const z=m.trim().toLowerCase();return z?A.name.toLowerCase().includes(z)||A.host.toLowerCase().includes(z)||A.path_prefix.toLowerCase().includes(z)||A.lb.toLowerCase().includes(z):!0}))},[p,m,S,o,f,c,_,x,v,b,I,w,L,M,r,a,s,u,T,O,G,ie,Z,ue,re,$,W,se,y,R,h,V,ne,fe,Q,ge]}class Ps extends Ke{constructor(t){super(),qe(this,t,Os,Ms,ze,{},null,[-1,-1])}}new Ps({target:document.getElementById("app")});
